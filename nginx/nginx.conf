user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
  worker_connections 768;
  # multi_accept on;
}

http {
  error_log /var/log/nginx/error.log;

  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;
  keepalive_timeout 65;
  types_hash_max_size 2048;
  # server_tokens off;

  server_names_hash_bucket_size 128;
  # server_name_in_redirect off;

  include /etc/nginx/mime.types;
  default_type application/octet-stream;


  client_max_body_size 1024m;

  ssl_session_timeout       1d;
  ssl_session_cache         shared:MozSSL:10m;
  ssl_session_tickets       off;
  ssl_protocols             TLSv1.2 TLSv1.3;
  ssl_ciphers               "ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";
  ssl_prefer_server_ciphers off;
  ssl_ecdh_curve            X25519:prime256v1:secp384r1:secp521r1;
  ssl_stapling              on;
  ssl_stapling_verify       on;

  gzip                      on;
  gzip_vary                 on;
  gzip_proxied              any;
  gzip_comp_level           6;
  gzip_buffers              16 8k;
  gzip_http_version         1.1;

  gzip_types                application/activity+json
                            application/atom+xml
                            application/javascript
                            application/json
                            application/manifest+json
                            application/rss+xml
                            application/xml
                            text/cache-manifest
                            text/calendar
                            text/css
                            text/javascript
                            text/markdown
                            text/plain
                            text/vcard
                            text/vnd.wap.wml
                            text/vtt
                            text/x-component
                            text/xml
                            ;

  index index.html;

  include /etc/nginx/conf.d/*.conf;
  include /etc/nginx/sites-enabled/*;
}
